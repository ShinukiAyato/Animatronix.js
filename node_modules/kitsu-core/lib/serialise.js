"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./error.js");function r(t,r,e,n){const o=new Error("".concat(n," requires an ID for the ").concat(r," type"));if(void 0===r)throw new Error("".concat(n," requires a resource type"));if(t){if("POST"!==n&&e.length>0)for(const t of e)if(!t.id)throw o}else{if((null==e?void 0:e.constructor)!==Object||0===Object.keys(e).length)throw new Error("".concat(n," requires an object or array body"));if("POST"!==n&&!e.id)throw o}}function e(t,r){let e={};for(const r of Object.keys(t))["id","type"].includes(r)?e[r]=t[r]:e=a(t[r],r,e);return e.type||(e.type=r),e}function n(t,r){const n=[];for(const o of t){const t=e(o);t.type||(t.type=r),n.push(t)}return n}function o(t,r,o,a){var s,i;return a.relationships||(a.relationships={}),a.relationships[o]={data:Array.isArray(t.data)?n(t.data,r):e(t.data,r)},((null==t||null===(s=t.links)||void 0===s?void 0:s.self)||(null==t||null===(i=t.links)||void 0===i?void 0:i.related))&&(a.relationships[o].links=t.links),(null==t?void 0:t.meta)&&(a.relationships[o].meta=t.meta),a}function a(t,r,e){return e.attributes||(e.attributes={}),"links"!==r||"string"!=typeof t.self&&"string"!=typeof t.related?"meta"===r&&t.constructor===Object?e.meta=t:e.attributes[r]=t:e.links=t,e}function s(t){if(!t.data)return!1;const r=Array.isArray(t.data)?t.data[0]:t.data;return Object.prototype.hasOwnProperty.call(r,"id")}function i(t,e,n,i){r(!1,t,e,n);let l={type:t=i.pluralTypes(i.camelCaseTypes(t))};(null==e?void 0:e.id)&&(l.id=String(e.id));for(const t in e){const r=e[t],n=i.pluralTypes(i.camelCaseTypes(t));null!==r&&(null==r?void 0:r.constructor)===Object&&s(r)?l=o(r,n,t,l):"id"!==t&&"type"!==t&&(l=a(r,t,l))}return{data:l}}exports.serialise=function(e,n={},o="POST",a={}){try{return a.camelCaseTypes||(a.camelCaseTypes=t=>t),a.pluralTypes||(a.pluralTypes=t=>t),null===n||Array.isArray(n)&&0===n.length?{data:n}:Array.isArray(n)&&(null==n?void 0:n.length)>0?function(t,e,n,o){r(!0,t,e,n);const a=[];for(const r of e)a.push(i(t,r,n,o).data);return{data:a}}(e,n,o,a):i(e,n,o,a)}catch(r){throw t.error(r)}};
